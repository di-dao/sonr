package highway

import (
	"github.com/go-chi/chi/v5"

	_ "github.com/sonrhq/sonr/docs" // docs is generated by Swag CLI, you have to import it.
	"github.com/sonrhq/sonr/pkg/highway/handlers"
	"github.com/sonrhq/sonr/pkg/highway/middleware"
)

// Start starts the highway server
func Start(opts ...HighwayOption) error {
	// Set the default options
	cnfg := NewHighwayOptions()
	for _, opt := range opts {
		opt(cnfg)
	}

	// Create the router
	r := chi.NewRouter()
	middleware.UseDefaults(r)
	handlers.BankAPI.RegisterRoutes(r)
	handlers.GovAPI.RegisterRoutes(r)
	handlers.StakingAPI.RegisterRoutes(r)
	handlers.CometAPI.RegisterRoutes(r)
	handlers.ServiceAPI.RegisterRoutes(r)
	handlers.MountHTMX(r)

	// Serve the router
	return cnfg.Serve(r)
}

// Handler returns the router
func Handler(opts ...HighwayOption) chi.Router {
	// Set the default options
	cnfg := NewHighwayOptions()
	for _, opt := range opts {
		opt(cnfg)
	}

	// Create the router
	r := chi.NewRouter()
	middleware.UseDefaults(r)
	handlers.BankAPI.RegisterRoutes(r)
	handlers.GovAPI.RegisterRoutes(r)
	handlers.StakingAPI.RegisterRoutes(r)
	handlers.CometAPI.RegisterRoutes(r)
	handlers.ServiceAPI.RegisterRoutes(r)

	// Return the router
	return r
}
