# ------------------------------------------------------------------------------
# Purpose - Configuring runner nodes and network services for production.
# ------------------------------------------------------------------------------

VERSION 0.7
PROJECT sonrhq/testnet-1

# configures a validator node image with arguments
node-validator:
    FROM golang:1.21.5-alpine
    WORKDIR /app
    RUN apk add --no-cache git
    COPY go.mod go.sum ./
    RUN go mod download
    SAVE ARTIFACT go.mod AS LOCAL go.mod
    SAVE ARTIFACT go.sum AS LOCAL go.sum

# configures a sentry node image with arguments
node-sentry:
    FROM +deps
    ARG goos=linux
    ARG goarch=amd64
    ENV GOOS=$goos
    ENV GOARCH=$goarch
    COPY . .
    RUN go build -o /app/sonrd ./cmd/sonrd
    SAVE ARTIFACT /app/sonrd AS LOCAL bin/sonrd

# configures a public node image with arguments
node-public:
    FROM sonrhq/sonrd:latest
    COPY ./bin/sonrd /usr/local/bin/sonrd
    RUN chmod +x /usr/local/bin/sonrd
    SAVE IMAGE sonrd:latest

# configures a hway image with arguments
rails-hway:
    FROM sonrhq/hway:latest
    COPY ./bin/hway /usr/local/bin/hway
    RUN chmod +x /usr/local/bin/hway
    SAVE IMAGE hway:latest

# configures a faucet image with arguments
rails-faucet:
    FROM alpine:3.14
    COPY ./bin/faucet /usr/local/bin/faucet
    RUN chmod +x /usr/local/bin/faucet
    SAVE IMAGE faucet:latest
