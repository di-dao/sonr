# Pin nixpkgs to get reproducable behaviour.
nixpkgs: https://github.com/NixOS/nixpkgs/archive/refs/tags/23.05.tar.gz

# Declare tasks below the build keyword.
build:
  # build - is the default task execute when building go binary.
  build:
    dependson:
      - binary
      - docker

  # generate - is the default task execute when executing code generation.
  generate:
    cmd: task generate
    input: proto

  # binary - is the default task execute when building go binary.
  binary:
    cmd: task build
    target: ./bin/sonrd

  # docker - is the default task execute when building docker image.
  docker:
    cmd: task docker-build
    dependson:
      - binary
    target:
      image: ghcr.io/sonr-io/sonrd:latest
dependencies:
  - go-task
  - go_1_19
  - git
  - wget
  - docker
  - gcc
