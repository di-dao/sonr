version: "3"
networks:
  tunnel:

services:
  # Cloudflared Reverse Proxy
  cloudflared:
    image: erisamoe/cloudflared
    command: tunnel run
    environment:
      - TUNNEL_TOKEN=${MATRIX_TUNNEL_TOKEN}
    networks:
      - tunnel

  # Matrix Homeserver
  dendrite:
    init: true
    hostname: dendrite
    image: sonrhq/dendrite:latest
    ports:
      - 8008:8008 # rest
      - 8448:8448 # e2e
    volumes:
     - /mnt/disks/matrix_data:/etc/dendrite
    networks:
     - tunnel
